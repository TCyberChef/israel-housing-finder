---
phase: 01-infrastructure-setup
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/lib/supabase.ts
  - .env.example
  - .github/workflows/deploy.yml
  - public/404.html
autonomous: true

user_setup:
  - service: supabase
    why: "Backend database and API services"
    env_vars:
      - name: VITE_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: VITE_SUPABASE_PUBLISHABLE_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> Project API keys -> anon/public key"
    dashboard_config:
      - task: "Create new Supabase project (free tier)"
        location: "https://supabase.com/dashboard - click 'New Project'"
        details: "Name: israel-housing-finder, Region: closest to Israel, Database password: generate strong password"

must_haves:
  truths:
    - "Supabase client is configured with environment variables"
    - "GitHub Actions workflow deploys to Pages on push to main"
    - "SPA client-side routing works via 404.html fallback"
  artifacts:
    - path: "src/lib/supabase.ts"
      provides: "Supabase client singleton"
      exports: ["supabase"]
      min_lines: 10
    - path: ".github/workflows/deploy.yml"
      provides: "Automated GitHub Pages deployment"
      contains: "peaceiris/actions-gh-pages"
      min_lines: 30
    - path: "public/404.html"
      provides: "SPA fallback for client-side routing"
      contains: "<!DOCTYPE html>"
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "VITE_SUPABASE_URL"
  key_links:
    - from: "src/lib/supabase.ts"
      to: "import.meta.env.VITE_SUPABASE_URL"
      via: "Vite environment variable"
      pattern: "import\\.meta\\.env\\.VITE_SUPABASE"
    - from: ".github/workflows/deploy.yml"
      to: "dist/ build output"
      via: "artifact upload and deploy"
      pattern: "path:\\s*\\./dist"
    - from: "public/404.html"
      to: "index.html"
      via: "content copy"
      pattern: "<!DOCTYPE html>"
---

<objective>
Configure Supabase backend connection and automated GitHub Pages deployment with SPA routing support

Purpose: Set up Supabase client for future database/API usage. Create GitHub Actions workflow for automatic deployment on every push to main. Add 404.html fallback to support client-side routing on GitHub Pages static hosting.

Output: Working Supabase client, automated deployment pipeline, SPA routing support
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-infrastructure-setup/01-RESEARCH.md
@.planning/phases/01-infrastructure-setup/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Supabase client with Vite environment variables</name>
  <files>
    src/lib/supabase.ts
    .env.example
  </files>
  <action>
Create src/lib/ directory if it doesn't exist.

Create src/lib/supabase.ts with Vite environment variable pattern:
```typescript
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables. Check .env.local file.')
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey)
```

Create .env.example (template for users):
```bash
# Supabase Configuration
# Get these values from: Supabase Dashboard -> Project Settings -> API
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=your_publishable_key_here
```

Delete old src/config/supabase.js (uses REACT_APP_ pattern, incompatible with Vite).

Note: User must create .env.local with actual values (not committed to git). This file is needed for local development but NOT required for build to succeed (environment variable check happens at runtime, not build time).
  </action>
  <verify>
Run `npm run build` - should succeed even without .env.local (env vars checked at runtime, not build time)
  </verify>
  <done>
src/lib/supabase.ts exists with Vite env vars, .env.example committed, old config/supabase.js deleted, build succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub Actions deployment workflow</name>
  <files>
    .github/workflows/deploy.yml
    public/404.html
  </files>
  <action>
Create .github/workflows/deploy.yml with two-job pattern (build + deploy):

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: production-files
          path: ./dist

  deploy:
    name: Deploy
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Download artifacts
        uses: actions/download-artifact@v4
        with:
          name: production-files
          path: ./dist

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
```

Create public/404.html as copy of root index.html for SPA fallback:
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/israel-housing-finder/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Israel Housing Finder</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/israel-housing-finder/src/main.tsx"></script>
  </body>
</html>
```

Note: public/404.html is copied to dist/ by Vite during build. GitHub Pages serves this when routes aren't found, allowing React to handle client-side routing.

Important: Do NOT commit .env or .env.local files. Verify .gitignore excludes them.
  </action>
  <verify>
Run `git add .github/workflows/deploy.yml public/404.html` and `git status` - workflow and 404.html should be staged, no .env files shown
  </verify>
  <done>
GitHub Actions workflow exists with build and deploy jobs, public/404.html created, no .env files in git, files ready to commit
  </done>
</task>

</tasks>

<verification>
1. src/lib/supabase.ts exists and uses import.meta.env.VITE_* pattern
2. .env.example exists and documents required variables
3. .github/workflows/deploy.yml exists with build and deploy jobs
4. public/404.html exists as SPA fallback
5. Old src/config/supabase.js is deleted
6. .gitignore excludes .env and .env.local
7. `npm run build` succeeds without .env.local
</verification>

<success_criteria>
- Supabase client configured with Vite environment variables
- GitHub Actions workflow ready to deploy on push to main
- SPA routing fallback (404.html) in place
- Environment variable template (.env.example) documented
- Build succeeds without runtime environment variables
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-setup/01-02-SUMMARY.md`
</output>
